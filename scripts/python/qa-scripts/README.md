# Project Catalyst Review of Reviews Tools

This project is simple collection of scripts to speed-up the "QA Assess Stage"
in Project Catalyst. The first iterations of the scripts were based on the
"Yellow & Red document" prepared by the community and the process is now
simplified and included into the Catalyst process.

In Fund 4 and 3, this process was based on Google Sheet and these
tools interacted with it using `gspread`.

From Fund 5 to the current (Fund 7) the process is still based on Google Sheets,
but various tools were developed by the community to interact with the CSV
exports - hopefully in a couple of funds we'll get rid of Google Sheets
completely.

## Disclaimer
This is not the most elegant script collection in the world.
Things may break and they differ greatly between iterations, so it's possible
that some part of the code it's just a quick fix for something that changed.

## Process

Steps of the process:

1. We get the Ideascale Assessments export, we create a new format for
assessments (grouping them by assessor) and we autoflag blank assessments.
In this step the assessments made by a CA who is also a proposer in the same
challenge will be discarded (`createProposerDocument.py`).  
In order to run the `createProposerDocument.py` and to perform the exclusion it
is necessary to have:

    - `proposals.json` => JSON list of all proposals with `id`, `category`,
      `title`, `url`
    - `users.json` => JSON list of all users with `id` (the anonymized id assigned
       to the user), `email`, `proposals` (list), `campaigns` (list), `userName`.
       Due to limitation in the IdeaScale platform that allows to receive only the
       list of users with the proposals ids, it is possible to use the script
       `updateUsersChallenges.py` to add the `campaigns` to each user
       (`proposals.json` file is required).
    - In `options.json` the option `originalExportFromIdeascale` should be set
      with the Google Sheet key of the original export of the assessments from
      IdeaScale.

  After the execution of `createProposerDocument.py` a Master File for proposers
with all the assessments will be created on GDrive.

2. Proposers make a copy of the `Proposer Master file` or use the
`proposal-review-tool` to report assessments that they judge unfair or
substandard. Each proposer upload a CSV file with their own report and submit
them through a Google Form.
Flags without rationale are excluded but it's possible to provide a text
feedback to the CA without flagging an assessment.

3. We run the `createProposerAggregate.py` to create an aggregated file with
all the assessments and the report made by proposers.
To run it, it's necessary to have all the proposers' CSV in the folder
`proposers-files`. These files can be downloaded from Google Sheet using the
utility script `DownloadCsvFromDrive.py`, setting a list of gDrive key in the
`self.fileList` variable.  
In order to run the `createProposerAggregate.py` it's necessary to have:

    - In `options.json` the option `proposersMasterFile` should be set
      with the Google Sheet key of the file generated by step `1`.


4. We run the `CreateVCAMaster.py` to create the master file that will be used
by Veteran Community Advisor to review all the assessments.
To run it, it's necessary to have:  

    - In `options.json` the option `proposersAggregateFile` should be set with
      the Google Sheet key of the file generated by step `3`.


5. In parallel we create an external file with a similarity check to be used by
vCA as reference using the script `createSimilarity.py`. To run the similarity
script it's necessary to have in `options.json` the option `VCAMasterFile` set
to the Google Sheet key of the file generated by step `4`.

5. vCAs make a copy of the `VCA Master file` or use the `vca-tool` to categorize
 all the assessments as `excellent`, `good` or `not valid`. Each vCA upload a
CSV file with their own report and submit them through a Google Form.
For each review it is possible to provide feedback to the CA in order not
interrupt the positive feedback loop but it is not mandatory.

6. We merge each single vCA file running the script `createVCAaggregate` to
calculate consensus on the `excellent`, `good` or `not valid` criteria, based on
 the consensus rule defined.  
To run it, it's necessary to have:  
    - all the vCAs' CSVs in the folder `vcas-files`.
    - In `options.json` the option `proposersMasterFile` should be set
      with the Google Sheet key of the file generated by step `1`.
    - In `options.json` the option `vcaMasterFile` should be set
      with the Google Sheet key of the file generated by step `4`.
    - In `options.json` the option `distinctChallenges` should be populated with
      the list of the Catalyst Natives challenges. For each of this challenges
      a specific `Valid Assessments` sheet will be generated.
    - `proposals.json` => JSON list of all proposals with `id`, `category`,
      `title`, `url`
    - `vcas.json` => JSON list of all vcas with `ca_id` (the anonymized
       Community Advisor id assigned to the vca), `vca_file` (reference to the
       file submitted by the vCA), `name` (list), `campaigns_as_proposers` (list
       , the list of all campaign ids in which the vca is also a proposer),
       `vca_link` the Google sheet link to the file submitted.
       The `vcas.json` could be populated with all non-private information using
       the `prepareVcaProfiles.py` (the `vcaResponses` option should be
       populated with the Google Sheet of the vCAs responses).

The final file will be generated by this script and it will include:
    - `Aggregated` tab with all the assessments and the data used for the
      categorization
    - `Valid Assessments` tab with the selection of all the valid assessments
    - `Proposal scores` tab with the recap of all the proposals final ratings
    - `Excluded assessments` tab with all the assessments excluded from the
      process (`not valid` or `blanks`)
    - `Veteran Community Advisors` tab with all the vCA who took part in the
      process with the number of review performed and the link to the specific
      vca file

## Requirements Installation

```
pip3 install -r requirements.txt
```

## Google API configuration

Create a `Service Account` for Google APIs.

1. Enable API Access for a Project if you haven’t done it yet.
2. Search for `Sheet` and `Drive` APIs and activate them.
3. Go to “APIs & Services > Credentials” and choose “Create credentials > Service account key”.
4. Fill out the form
5. Click “Create” and “Done”.
6. Press “Manage service accounts” above Service Accounts.
7. Press on `⋮` near recenlty created service account and select “Create key”.
8. Select JSON key type and press “Create”.
9. Copy the downloaded json to `gsheet-accounts/service_account.json`

### Other tools
`serviceAccountUtils.py` is used to delete every document in the service account.
Use carefully.
